Author: Cristian Greco <cristian.debian@gmail.com>
Description: Fix html documentation for offline browsing and add another
missing doc file. The patch also includes the makefile and template.txt needed
to rebuild html docs from rst files.
--- a/docs/index.html
+++ b/docs/index.html
@@ -3,10 +3,10 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title></title>
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -19,15 +19,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 
 
@@ -64,7 +60,7 @@
 </ul>
 <hr class="docutils" />
 <ul class="simple">
-<li><a class="reference external" href="bittorrent.pdf">Introduction, slides</a></li>
+<li><a class="reference external" href="http://www.rasterbar.com/products/libtorrent/bittorrent.pdf">Introduction, slides</a></li>
 </ul>
 </div>
 <div id="libraryBody"><div class="section" id="libtorrent">
@@ -81,17 +77,9 @@
 </ul>
 <div class="section" id="donate">
 <h2>Donate</h2>
-<p>Support the development of libtorrent</p>
-<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
-        <input type="hidden" name="cmd" value="_xclick">
-        <input type="hidden" name="business" value="arvid@cs.umu.se">
-        <input type="hidden" name="item_name" value="libtorrent">
-        <input type="hidden" name="return" value="http://libtorrent.sf.net">
-        <input type="hidden" name="currency_code" value="USD">
-        <input type="hidden" name="tax" value="0">
-        <input type="image" src="https://www.paypal.com/images/x-click-but04.gif"
-                border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!">
-</form></div>
+<p>Support the development of libtorrent.</p>
+<p>(via <a class="reference external" href="http://www.rasterbar.com/products/libtorrent/index.html">paypal</a> on Rasterbar's homepage)</p>
+</div>
 <div class="section" id="feedback">
 <h2>Feedback</h2>
 <p>There's a <a class="reference external" href="http://lists.sourceforge.net/lists/listinfo/libtorrent-discuss">mailing list</a>, general libtorrent discussion.</p>
@@ -102,8 +90,7 @@
 <p>Written by Arvid Norberg. Copyright (c) 2003-2006</p>
 <p>Contributions by Magnus Jonsson, Daniel Wallin and Cory Nelson</p>
 <p>Thanks to Reimond Retz for bugfixes, suggestions and testing</p>
-<p>Project is hosted by sourceforge.</p>
-<p><a class="reference external" href="http://sourceforge.net"><img alt="sf_logo" src="http://sourceforge.net/sflogo.php?group_id=7994" /></a></p>
+<p>Project is hosted by <a class="reference external" href="http://sourceforge.net">sourceforge</a>.</p>
 </div></div>
 </div>
     </div>
@@ -111,12 +98,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- /dev/null
+++ b/docs/template.txt
@@ -0,0 +1,29 @@
+%(head_prefix)s
+%(head)s
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
+%(stylesheet)s
+<style type="text/css">
+/* Hides from IE-mac \*/
+* html pre { height: 1%%; }
+/* End hide from IE-mac */
+</style>
+%(body_prefix)s
+    <div id="container">
+    <div id="headerNav">
+    <ul>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
+    </ul>
+    </div>
+    <div id="main">
+%(body_pre_docinfo)s
+%(docinfo)s
+%(body)s
+    </div>
+    <div id="footer">
+    <span>Copyright &copy; 2005 Rasterbar Software.</span>
+    </div>
+    </div>
+%(body_suffix)s
--- /dev/null
+++ b/docs/makefile
@@ -0,0 +1,30 @@
+#!/usr/bin/make -f
+# Upstream Author: Arvid Norberg - Modified by: Cristian Greco
+# This file has been downloaded from upstream svn and simplified in order to
+# generate an html documentation suitable for offline browsing.
+# This makefile assumes that you have python-docutils installed.
+
+TARGETS = \
+	index \
+	udp_tracker_protocol \
+	client_test \
+	manual \
+	building \
+	features \
+	examples \
+	extension_protocol \
+	make_torrent \
+	dht_extensions \
+	libtorrent_plugins \
+	python_binding \
+	projects
+
+all: html
+
+html: $(TARGETS:=.html)
+
+%.html:%.rst
+	rst2html --template=template.txt --stylesheet-path=style.css --link-stylesheet --no-toc-backlinks $? > $@
+
+clean:
+	@rm -f $(TARGETS:=.html)
--- a/docs/building.html
+++ b/docs/building.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>libtorrent manual</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">libtorrent manual</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -738,12 +734,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/client_test.html
+++ b/docs/client_test.html
@@ -3,10 +3,10 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>client_test example program</title>
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -19,15 +19,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">client_test example program</h1>
 
@@ -75,12 +71,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/dht_extensions.html
+++ b/docs/dht_extensions.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title></title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 
 <table class="docinfo" frame="void" rules="none">
@@ -91,12 +87,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/examples.html
+++ b/docs/examples.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>libtorrent Examples</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">libtorrent Examples</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -302,12 +298,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/extension_protocol.html
+++ b/docs/extension_protocol.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title></title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com Ludvig Strigeus, ludde&#64;utorrent.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 
 <table class="docinfo" frame="void" rules="none">
@@ -290,12 +286,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/features.html
+++ b/docs/features.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>libtorrent manual</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">libtorrent manual</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -154,12 +150,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- /dev/null
+++ b/docs/libtorrent_plugins.html
@@ -0,0 +1,263 @@
+<?xml version="1.0" encoding="utf-8" ?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
+<head>
+<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
+<title></title>
+<meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
+<link rel="stylesheet" href="style.css" type="text/css" />
+<style type="text/css">
+/* Hides from IE-mac \*/
+* html pre { height: 1%; }
+/* End hide from IE-mac */
+</style>
+</head>
+<body>
+<div class="document">
+    <div id="container">
+    <div id="headerNav">
+    <ul>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
+    </ul>
+    </div>
+    <div id="main">
+
+<table class="docinfo" frame="void" rules="none">
+<col class="docinfo-name" />
+<col class="docinfo-content" />
+<tbody valign="top">
+<tr><th class="docinfo-name">Author:</th>
+<td>Arvid Norberg, <a class="last reference external" href="mailto:arvid&#64;rasterbar.com">arvid&#64;rasterbar.com</a></td></tr>
+</tbody>
+</table>
+<div class="section" id="libtorrent-plugins">
+<h1>libtorrent plugins</h1>
+<div class="contents topic" id="contents">
+<p class="topic-title first">Contents</p>
+<ul class="simple">
+<li><a class="reference internal" href="#libtorrent-plugins" id="id1">libtorrent plugins</a><ul>
+<li><a class="reference internal" href="#a-word-of-caution" id="id2">a word of caution</a></li>
+</ul>
+</li>
+<li><a class="reference internal" href="#plugin-interface" id="id3">plugin interface</a></li>
+<li><a class="reference internal" href="#torrent-plugin" id="id4">torrent_plugin</a><ul>
+<li><a class="reference internal" href="#new-connection" id="id5">new_connection()</a></li>
+<li><a class="reference internal" href="#on-piece-pass-on-piece-fail" id="id6">on_piece_pass() on_piece_fail()</a></li>
+<li><a class="reference internal" href="#tick" id="id7">tick()</a></li>
+<li><a class="reference internal" href="#on-pause-on-resume" id="id8">on_pause() on_resume()</a></li>
+<li><a class="reference internal" href="#on-files-checked" id="id9">on_files_checked()</a></li>
+</ul>
+</li>
+<li><a class="reference internal" href="#peer-plugin" id="id10">peer_plugin</a></li>
+<li><a class="reference internal" href="#disk-buffer-holder" id="id11">disk_buffer_holder</a></li>
+</ul>
+</div>
+<p>libtorrent has a plugin interface for implementing extensions to the protocol.
+These can be general extensions for transferring metadata or peer exchange
+extensions, or it could be used to provide a way to customize the protocol
+to fit a particular (closed) network.</p>
+<p>In short, the plugin interface makes it possible to:</p>
+<ul class="simple">
+<li>register extension messages (sent in the extension handshake), see
+<a class="reference external" href="extension_protocol.html">extensions</a>.</li>
+<li>add data and parse data from the extension handshake.</li>
+<li>send extension messages and standard bittorrent messages.</li>
+<li>override or block the handling of standard bittorrent messages.</li>
+</ul>
+<div class="section" id="a-word-of-caution">
+<h2>a word of caution</h2>
+<p>Writing your own plugin is a very easy way to introduce serious bugs such as
+dead locks and race conditions. Since a plugin has access to internal
+structures it is also quite easy to sabotage libtorrent's operation.</p>
+<p>All the callbacks in this interface are called with the main libtorrent thread
+mutex locked. And they are always called from the libtorrent main thread. In
+case portions of your plugin are called from other threads, typically the main
+thread, you cannot use any of the member functions on the internal structures
+in libtorrent, since those require the mutex to be locked. Futhermore, you would
+also need to have a mutex on your own shared data within the plugin, to make
+sure it is not accessed at the same time from the libtorrent thread (through a
+callback). See <a class="reference external" href="http://www.boost.org/doc/html/mutex.html">boost thread's mutex</a>. If you need to send out a message from
+another thread, use an internal queue, and do the actual sending in <tt class="docutils literal"><span class="pre">tick()</span></tt>.</p>
+</div>
+</div>
+<div class="section" id="plugin-interface">
+<h1>plugin interface</h1>
+<p>The plugin interface consists of two base classes that the plugin may
+implement. These are called <tt class="docutils literal"><span class="pre">torrent_plugin</span></tt> and <tt class="docutils literal"><span class="pre">peer_plugin</span></tt>. They are
+both found in the <tt class="docutils literal"><span class="pre">&lt;libtorrent/extensions.hpp&gt;</span></tt> header.</p>
+<p>These plugins are instantiated for each torrent and possibly each peer,
+respectively.</p>
+<p>This is done by passing in a function or function object to
+<tt class="docutils literal"><span class="pre">session::add_extension()</span></tt> or <tt class="docutils literal"><span class="pre">torrent_handle::add_extension()</span></tt> (if the
+torrent has already been started and you want to hook in the extension at
+run-time).</p>
+<p>The signature of the function is:</p>
+<pre class="literal-block">
+boost::shared_ptr&lt;torrent_plugin&gt; (*)(torrent*, void*);
+</pre>
+<p>The first argument is the internal torrent object, the second argument
+is the userdata passed to <tt class="docutils literal"><span class="pre">session::add_torrent()</span></tt> or
+<tt class="docutils literal"><span class="pre">torrent_handle::add_extension()</span></tt>.</p>
+<p>The function should return a <tt class="docutils literal"><span class="pre">boost::shared_ptr&lt;torrent_plugin&gt;</span></tt> which
+may or may not be 0. If it is a null pointer, the extension is simply ignored
+for this torrent. If it is a valid pointer (to a class inheriting
+<tt class="docutils literal"><span class="pre">torrent_plugin</span></tt>), it will be associated with this torrent and callbacks
+will be made on torrent events.</p>
+</div>
+<div class="section" id="torrent-plugin">
+<h1>torrent_plugin</h1>
+<p>The synopsis for <tt class="docutils literal"><span class="pre">torrent_plugin</span></tt> follows:</p>
+<pre class="literal-block">
+struct torrent_plugin
+{
+        virtual ~torrent_plugin();
+        virtual boost::shared_ptr&lt;peer_plugin&gt; new_connection(peer_connection*);
+
+        virtual void on_piece_pass(int index);
+        virtual void on_piece_failed(int index);
+
+        virtual void tick();
+
+        virtual bool on_pause();
+        virtual bool on_resume();
+
+        virtual void on_files_checked();
+};
+</pre>
+<p>This is the base class for a torrent_plugin. Your derived class is (if added
+as an extension) instantiated for each torrent in the session. The callback
+hook functions are defined as follows.</p>
+<div class="section" id="new-connection">
+<h2>new_connection()</h2>
+<pre class="literal-block">
+boost::shared_ptr&lt;peer_plugin&gt; new_connection(peer_connection*);
+</pre>
+<p>This function is called each time a new peer is connected to the torrent. You
+may choose to ignore this by just returning a default constructed
+<tt class="docutils literal"><span class="pre">shared_ptr</span></tt> (in which case you don't need to override this member
+function).</p>
+<p>If you need an extension to the peer connection (which most plugins do) you
+are supposed to return an instance of your <tt class="docutils literal"><span class="pre">peer_plugin</span></tt> class. Which in
+turn will have its hook functions called on event specific to that peer.</p>
+<p>The <tt class="docutils literal"><span class="pre">peer_connection</span></tt> will be valid as long as the <tt class="docutils literal"><span class="pre">shared_ptr</span></tt> is being
+held by the torrent object. So, it is generally a good idea to not keep a
+<tt class="docutils literal"><span class="pre">shared_ptr</span></tt> to your own peer_plugin. If you want to keep references to it,
+use <tt class="docutils literal"><span class="pre">weak_ptr</span></tt>.</p>
+<p>If this function throws an exception, the connection will be closed.</p>
+</div>
+<div class="section" id="on-piece-pass-on-piece-fail">
+<h2>on_piece_pass() on_piece_fail()</h2>
+<pre class="literal-block">
+void on_piece_pass(int index);
+void on_piece_failed(int index);
+</pre>
+<p>These hooks are called when a piece passes the hash check or fails the hash
+check, respectively. The <tt class="docutils literal"><span class="pre">index</span></tt> is the piece index that was downloaded.
+It is possible to access the list of peers that participated in sending the
+piece through the <tt class="docutils literal"><span class="pre">torrent</span></tt> and the <tt class="docutils literal"><span class="pre">piece_picker</span></tt>.</p>
+</div>
+<div class="section" id="tick">
+<h2>tick()</h2>
+<pre class="literal-block">
+void tick();
+</pre>
+<p>This hook is called approximately once per second. It is a way of making it
+easy for plugins to do timed events, for sending messages or whatever.</p>
+</div>
+<div class="section" id="on-pause-on-resume">
+<h2>on_pause() on_resume()</h2>
+<pre class="literal-block">
+bool on_pause();
+bool on_resume();
+</pre>
+<p>These hooks are called when the torrent is paused and unpaused respectively.
+The return value indicates if the event was handled. A return value of
+<tt class="docutils literal"><span class="pre">true</span></tt> indicates that it was handled, and no other plugin after this one
+will have this hook function called, and the standard handler will also not be
+invoked. So, returning true effectively overrides the standard behavior of
+pause or unpause.</p>
+<p>Note that if you call <tt class="docutils literal"><span class="pre">pause()</span></tt> or <tt class="docutils literal"><span class="pre">resume()</span></tt> on the torrent from your
+handler it will recurse back into your handler, so in order to invoke the
+standard handler, you have to keep your own state on whether you want standard
+behavior or overridden behavior.</p>
+</div>
+<div class="section" id="on-files-checked">
+<h2>on_files_checked()</h2>
+<pre class="literal-block">
+void on_files_checked();
+</pre>
+<p>This function is called when the initial files of the torrent have been
+checked. If there are no files to check, this function is called immediately.</p>
+<p>i.e. This function is always called when the torrent is in a state where it
+can start downloading.</p>
+</div>
+</div>
+<div class="section" id="peer-plugin">
+<h1>peer_plugin</h1>
+<pre class="literal-block">
+struct peer_plugin
+{
+        virtual ~peer_plugin();
+
+        virtual void add_handshake(entry&amp;);
+        virtual bool on_handshake(char const* reserved_bits);
+        virtual bool on_extension_handshake(lazy_entry const&amp; h);
+
+        virtual bool on_choke();
+        virtual bool on_unchoke();
+        virtual bool on_interested();
+        virtual bool on_not_interested();
+        virtual bool on_have(int index);
+        virtual bool on_bitfield(bitfield const&amp; bits);
+        virtual bool on_have_all();
+        virtual bool on_have_none();
+        virtual bool on_allowed_fast(int index);
+        virtual bool on_request(peer_request const&amp; req);
+        virtual bool on_piece(peer_request const&amp; piece, disk_buffer_holder&amp; buffer);
+        virtual bool on_cancel(peer_request const&amp; req);
+        virtual bool on_reject(peer_request const&amp; req);
+        virtual bool on_suggest(int index);
+        virtual bool on_extended(int length
+                , int msg, buffer::const_interval body);
+        virtual bool on_unknown_message(int length, int msg
+                , buffer::const_interval body);
+        virtual void on_piece_pass(int index);
+        virtual void on_piece_failed(int index);
+
+        virtual void tick();
+
+        virtual bool write_request(peer_request const&amp; r);
+};
+</pre>
+</div>
+<div class="section" id="disk-buffer-holder">
+<h1>disk_buffer_holder</h1>
+<pre class="literal-block">
+struct disk_buffer_holder
+{
+        disk_buffer_holder(aux::session_impl&amp; s, char* b);
+        ~disk_buffer_holder();
+        char* release();
+        char* buffer();
+};
+</pre>
+<p>The disk buffer holder acts like a <tt class="docutils literal"><span class="pre">scoped_ptr</span></tt> that frees a disk buffer
+when it's destructed, unless it's released. <tt class="docutils literal"><span class="pre">release</span></tt> returns the disk
+buffer and transferres ownership and responsibility to free it to the caller.</p>
+<p>A disk buffer is freed by passing it to <tt class="docutils literal"><span class="pre">session_impl::free_disk_buffer()</span></tt>.</p>
+<p><tt class="docutils literal"><span class="pre">buffer()</span></tt> returns the pointer without transferring responsibility. If
+this buffer has been released, <tt class="docutils literal"><span class="pre">buffer()</span></tt> will return 0.</p>
+</div>
+    </div>
+    <div id="footer">
+    <span>Copyright &copy; 2005 Rasterbar Software.</span>
+    </div>
+    </div>
+</div>
+</body>
+</html>
--- /dev/null
+++ b/docs/libtorrent_plugins.rst
@@ -0,0 +1,240 @@
+:Author: Arvid Norberg, arvid@rasterbar.com
+
+libtorrent plugins
+==================
+
+.. contents::
+
+libtorrent has a plugin interface for implementing extensions to the protocol.
+These can be general extensions for transferring metadata or peer exchange
+extensions, or it could be used to provide a way to customize the protocol
+to fit a particular (closed) network.
+
+In short, the plugin interface makes it possible to:
+
+* register extension messages (sent in the extension handshake), see
+  extensions_.
+* add data and parse data from the extension handshake.
+* send extension messages and standard bittorrent messages.
+* override or block the handling of standard bittorrent messages.
+
+.. _extensions: extension_protocol.html
+
+a word of caution
+-----------------
+
+Writing your own plugin is a very easy way to introduce serious bugs such as
+dead locks and race conditions. Since a plugin has access to internal
+structures it is also quite easy to sabotage libtorrent's operation.
+
+All the callbacks in this interface are called with the main libtorrent thread
+mutex locked. And they are always called from the libtorrent main thread. In
+case portions of your plugin are called from other threads, typically the main
+thread, you cannot use any of the member functions on the internal structures
+in libtorrent, since those require the mutex to be locked. Futhermore, you would
+also need to have a mutex on your own shared data within the plugin, to make
+sure it is not accessed at the same time from the libtorrent thread (through a
+callback). See `boost thread's mutex`_. If you need to send out a message from
+another thread, use an internal queue, and do the actual sending in ``tick()``.
+
+.. _`boost thread's mutex`: http://www.boost.org/doc/html/mutex.html
+
+
+plugin interface
+================
+
+The plugin interface consists of two base classes that the plugin may
+implement. These are called ``torrent_plugin`` and ``peer_plugin``. They are
+both found in the ``<libtorrent/extensions.hpp>`` header.
+
+These plugins are instantiated for each torrent and possibly each peer,
+respectively.
+
+This is done by passing in a function or function object to
+``session::add_extension()`` or ``torrent_handle::add_extension()`` (if the
+torrent has already been started and you want to hook in the extension at
+run-time).
+
+The signature of the function is::
+
+	boost::shared_ptr<torrent_plugin> (*)(torrent*, void*);
+
+The first argument is the internal torrent object, the second argument
+is the userdata passed to ``session::add_torrent()`` or
+``torrent_handle::add_extension()``.
+
+The function should return a ``boost::shared_ptr<torrent_plugin>`` which
+may or may not be 0. If it is a null pointer, the extension is simply ignored
+for this torrent. If it is a valid pointer (to a class inheriting
+``torrent_plugin``), it will be associated with this torrent and callbacks
+will be made on torrent events.
+
+
+torrent_plugin
+==============
+
+The synopsis for ``torrent_plugin`` follows::
+
+	struct torrent_plugin
+	{
+		virtual ~torrent_plugin();
+		virtual boost::shared_ptr<peer_plugin> new_connection(peer_connection*);
+
+		virtual void on_piece_pass(int index);
+		virtual void on_piece_failed(int index);
+
+		virtual void tick();
+
+		virtual bool on_pause();
+		virtual bool on_resume();
+
+		virtual void on_files_checked();
+	};
+
+This is the base class for a torrent_plugin. Your derived class is (if added
+as an extension) instantiated for each torrent in the session. The callback
+hook functions are defined as follows.
+
+
+new_connection()
+----------------
+
+::
+
+	boost::shared_ptr<peer_plugin> new_connection(peer_connection*);
+
+This function is called each time a new peer is connected to the torrent. You
+may choose to ignore this by just returning a default constructed
+``shared_ptr`` (in which case you don't need to override this member
+function).
+
+If you need an extension to the peer connection (which most plugins do) you
+are supposed to return an instance of your ``peer_plugin`` class. Which in
+turn will have its hook functions called on event specific to that peer.
+
+The ``peer_connection`` will be valid as long as the ``shared_ptr`` is being
+held by the torrent object. So, it is generally a good idea to not keep a
+``shared_ptr`` to your own peer_plugin. If you want to keep references to it,
+use ``weak_ptr``.
+
+If this function throws an exception, the connection will be closed.
+
+on_piece_pass() on_piece_fail()
+-------------------------------
+
+::
+
+	void on_piece_pass(int index);
+	void on_piece_failed(int index);
+
+These hooks are called when a piece passes the hash check or fails the hash
+check, respectively. The ``index`` is the piece index that was downloaded.
+It is possible to access the list of peers that participated in sending the
+piece through the ``torrent`` and the ``piece_picker``.
+
+tick()
+------
+
+::
+
+	void tick();
+
+This hook is called approximately once per second. It is a way of making it
+easy for plugins to do timed events, for sending messages or whatever.
+
+
+on_pause() on_resume()
+----------------------
+
+::
+
+	bool on_pause();
+	bool on_resume();
+
+These hooks are called when the torrent is paused and unpaused respectively.
+The return value indicates if the event was handled. A return value of
+``true`` indicates that it was handled, and no other plugin after this one
+will have this hook function called, and the standard handler will also not be
+invoked. So, returning true effectively overrides the standard behavior of
+pause or unpause.
+
+Note that if you call ``pause()`` or ``resume()`` on the torrent from your
+handler it will recurse back into your handler, so in order to invoke the
+standard handler, you have to keep your own state on whether you want standard
+behavior or overridden behavior.
+
+on_files_checked()
+------------------
+
+::
+
+	void on_files_checked();
+
+This function is called when the initial files of the torrent have been
+checked. If there are no files to check, this function is called immediately.
+
+i.e. This function is always called when the torrent is in a state where it
+can start downloading.
+
+
+peer_plugin
+===========
+
+::
+
+	struct peer_plugin
+	{
+		virtual ~peer_plugin();
+
+		virtual void add_handshake(entry&);
+		virtual bool on_handshake(char const* reserved_bits);
+		virtual bool on_extension_handshake(lazy_entry const& h);
+
+		virtual bool on_choke();
+		virtual bool on_unchoke();
+		virtual bool on_interested();
+		virtual bool on_not_interested();
+		virtual bool on_have(int index);
+		virtual bool on_bitfield(bitfield const& bits);
+		virtual bool on_have_all();
+		virtual bool on_have_none();
+		virtual bool on_allowed_fast(int index);
+		virtual bool on_request(peer_request const& req);
+		virtual bool on_piece(peer_request const& piece, disk_buffer_holder& buffer);
+		virtual bool on_cancel(peer_request const& req);
+		virtual bool on_reject(peer_request const& req);
+		virtual bool on_suggest(int index);
+		virtual bool on_extended(int length
+			, int msg, buffer::const_interval body);
+		virtual bool on_unknown_message(int length, int msg
+			, buffer::const_interval body);
+		virtual void on_piece_pass(int index);
+		virtual void on_piece_failed(int index);
+
+		virtual void tick();
+
+		virtual bool write_request(peer_request const& r);
+	};
+
+disk_buffer_holder
+==================
+
+::
+
+	struct disk_buffer_holder
+	{
+		disk_buffer_holder(aux::session_impl& s, char* b);
+		~disk_buffer_holder();
+		char* release();
+		char* buffer();
+	};
+
+The disk buffer holder acts like a ``scoped_ptr`` that frees a disk buffer
+when it's destructed, unless it's released. ``release`` returns the disk
+buffer and transferres ownership and responsibility to free it to the caller.
+
+A disk buffer is freed by passing it to ``session_impl::free_disk_buffer()``.
+
+``buffer()`` returns the pointer without transferring responsibility. If
+this buffer has been released, ``buffer()`` will return 0.
+
--- a/docs/make_torrent.html
+++ b/docs/make_torrent.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>creating torrents</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">creating torrents</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -333,12 +329,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/manual.html
+++ b/docs/manual.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>libtorrent API Documentation</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">libtorrent API Documentation</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -213,44 +209,45 @@
 </li>
 <li><a class="reference internal" href="#storage-interface" id="id168">storage_interface</a><ul>
 <li><a class="reference internal" href="#initialize" id="id169">initialize()</a></li>
-<li><a class="reference internal" href="#read" id="id170">read()</a></li>
-<li><a class="reference internal" href="#write" id="id171">write()</a></li>
-<li><a class="reference internal" href="#id13" id="id172">move_storage()</a></li>
-<li><a class="reference internal" href="#verify-resume-data" id="id173">verify_resume_data()</a></li>
-<li><a class="reference internal" href="#write-resume-data" id="id174">write_resume_data()</a></li>
-<li><a class="reference internal" href="#move-slot" id="id175">move_slot()</a></li>
-<li><a class="reference internal" href="#swap-slots" id="id176">swap_slots()</a></li>
-<li><a class="reference internal" href="#swap-slots3" id="id177">swap_slots3()</a></li>
-<li><a class="reference internal" href="#hash-for-slot" id="id178">hash_for_slot()</a></li>
-<li><a class="reference internal" href="#id14" id="id179">rename_file()</a></li>
-<li><a class="reference internal" href="#release-files" id="id180">release_files()</a></li>
-<li><a class="reference internal" href="#delete-files" id="id181">delete_files()</a></li>
+<li><a class="reference internal" href="#has-any-file" id="id170">has_any_file()</a></li>
+<li><a class="reference internal" href="#read" id="id171">read()</a></li>
+<li><a class="reference internal" href="#write" id="id172">write()</a></li>
+<li><a class="reference internal" href="#id13" id="id173">move_storage()</a></li>
+<li><a class="reference internal" href="#verify-resume-data" id="id174">verify_resume_data()</a></li>
+<li><a class="reference internal" href="#write-resume-data" id="id175">write_resume_data()</a></li>
+<li><a class="reference internal" href="#move-slot" id="id176">move_slot()</a></li>
+<li><a class="reference internal" href="#swap-slots" id="id177">swap_slots()</a></li>
+<li><a class="reference internal" href="#swap-slots3" id="id178">swap_slots3()</a></li>
+<li><a class="reference internal" href="#hash-for-slot" id="id179">hash_for_slot()</a></li>
+<li><a class="reference internal" href="#id14" id="id180">rename_file()</a></li>
+<li><a class="reference internal" href="#release-files" id="id181">release_files()</a></li>
+<li><a class="reference internal" href="#delete-files" id="id182">delete_files()</a></li>
 </ul>
 </li>
-<li><a class="reference internal" href="#magnet-links" id="id182">magnet links</a></li>
-<li><a class="reference internal" href="#queuing" id="id183">queuing</a><ul>
-<li><a class="reference internal" href="#downloading" id="id184">downloading</a></li>
-<li><a class="reference internal" href="#seeding" id="id185">seeding</a></li>
+<li><a class="reference internal" href="#magnet-links" id="id183">magnet links</a></li>
+<li><a class="reference internal" href="#queuing" id="id184">queuing</a><ul>
+<li><a class="reference internal" href="#downloading" id="id185">downloading</a></li>
+<li><a class="reference internal" href="#seeding" id="id186">seeding</a></li>
 </ul>
 </li>
-<li><a class="reference internal" href="#fast-resume" id="id186">fast resume</a><ul>
-<li><a class="reference internal" href="#file-format" id="id187">file format</a></li>
+<li><a class="reference internal" href="#fast-resume" id="id187">fast resume</a><ul>
+<li><a class="reference internal" href="#file-format" id="id188">file format</a></li>
 </ul>
 </li>
-<li><a class="reference internal" href="#threads" id="id188">threads</a></li>
-<li><a class="reference internal" href="#storage-allocation" id="id189">storage allocation</a><ul>
-<li><a class="reference internal" href="#sparse-allocation" id="id190">sparse allocation</a></li>
-<li><a class="reference internal" href="#full-allocation" id="id191">full allocation</a></li>
-<li><a class="reference internal" href="#compact-allocation" id="id192">compact allocation</a></li>
+<li><a class="reference internal" href="#threads" id="id189">threads</a></li>
+<li><a class="reference internal" href="#storage-allocation" id="id190">storage allocation</a><ul>
+<li><a class="reference internal" href="#sparse-allocation" id="id191">sparse allocation</a></li>
+<li><a class="reference internal" href="#full-allocation" id="id192">full allocation</a></li>
+<li><a class="reference internal" href="#compact-allocation" id="id193">compact allocation</a></li>
 </ul>
 </li>
-<li><a class="reference internal" href="#extensions" id="id193">extensions</a><ul>
-<li><a class="reference internal" href="#metadata-from-peers" id="id194">metadata from peers</a></li>
-<li><a class="reference internal" href="#http-seeding" id="id195">HTTP seeding</a></li>
+<li><a class="reference internal" href="#extensions" id="id194">extensions</a><ul>
+<li><a class="reference internal" href="#metadata-from-peers" id="id195">metadata from peers</a></li>
+<li><a class="reference internal" href="#http-seeding" id="id196">HTTP seeding</a></li>
 </ul>
 </li>
-<li><a class="reference internal" href="#filename-checks" id="id196">filename checks</a></li>
-<li><a class="reference internal" href="#acknowledgments" id="id197">acknowledgments</a></li>
+<li><a class="reference internal" href="#filename-checks" id="id197">filename checks</a></li>
+<li><a class="reference internal" href="#acknowledgments" id="id198">acknowledgments</a></li>
 </ul>
 </div>
 <div class="section" id="overview">
@@ -632,6 +629,8 @@
 of upload rate.
 <tt class="docutils literal"><span class="pre">download_rate_limit()</span></tt> and <tt class="docutils literal"><span class="pre">upload_rate_limit()</span></tt> returns the previously
 set limits.</p>
+<p>Upload and download rate limits are not applied to peers on the local network
+by default. To change that, see <tt class="docutils literal"><span class="pre">session_settings::ignore_limits_on_local_network</span></tt>.</p>
 </div>
 <div class="section" id="set-max-uploads-set-max-connections">
 <h2>set_max_uploads() set_max_connections()</h2>
@@ -4434,12 +4433,27 @@
 <div class="section" id="storage-interface">
 <h1>storage_interface</h1>
 <p>The storage interface is a pure virtual class that can be implemented to
-change the behavior of the actual file storage. The interface looks like
-this:</p>
+customize how and where data for a torrent is stored. The default storage
+implementation uses regular files in the filesystem, mapping the files in the
+torrent in the way one would assume a torrent is saved to disk. Implementing
+your own storage interface makes it possible to store all data in RAM, or in
+some optimized order on disk (the order the pieces are received for instance),
+or saving multifile torrents in a single file in order to be able to take
+advantage of optimized disk-I/O.</p>
+<p>It is also possible to write a thin class that uses the default storage but
+modifies some particular behavior, for instance encrypting the data before
+it's written to disk, and decrypting it when it's read again.</p>
+<p>The storage interface is based on slots, each slot is 'piece_size' number
+of bytes. All access is done by writing and reading whole or partial
+slots. One slot is one piece in the torrent, but the data in the slot
+does not necessarily correspond to the piece with the same index (in
+compact allocation mode it won't).</p>
+<p>The interface looks like this:</p>
 <pre class="literal-block">
 struct storage_interface
 {
         virtual bool initialize(bool allocate_files) = 0;
+        virtual bool has_any_file() = 0;
         virtual int read(char* buf, int slot, int offset, int size) = 0;
         virtual int write(const char* buf, int slot, int offset, int size) = 0;
         virtual bool move_storage(fs::path save_path) = 0;
@@ -4467,6 +4481,17 @@
 it will also <tt class="docutils literal"><span class="pre">ftruncate</span></tt> all files to their target size.</p>
 <p>Returning <tt class="docutils literal"><span class="pre">true</span></tt> indicates an error occurred.</p>
 </div>
+<div class="section" id="has-any-file">
+<h2>has_any_file()</h2>
+<blockquote>
+<pre class="literal-block">
+virtual bool has_any_file() = 0;
+</pre>
+</blockquote>
+<p>This function is called when first checking (or re-checking) the storage for a torrent.
+It should return true if any of the files that is used in this storage exists on disk.
+If so, the storage will be checked for existing pieces before starting the download.</p>
+</div>
 <div class="section" id="read">
 <h2>read()</h2>
 <blockquote>
@@ -5096,12 +5121,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/projects.html
+++ b/docs/projects.html
@@ -3,10 +3,10 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>projects using libtorrent</title>
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -19,15 +19,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">projects using libtorrent</h1>
 
@@ -193,12 +189,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/python_binding.html
+++ b/docs/python_binding.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>libtorrent python binding</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">libtorrent python binding</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -158,12 +154,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- a/docs/udp_tracker_protocol.html
+++ b/docs/udp_tracker_protocol.html
@@ -3,11 +3,11 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
-<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
+<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
 <title>Bittorrent udp-tracker protocol extension</title>
 <meta name="author" content="Arvid Norberg, arvid&#64;rasterbar.com" />
-<link rel="stylesheet" type="text/css" href="../../css/base.css" />
-<link rel="stylesheet" type="text/css" href="../../css/rst.css" />
+<link rel="stylesheet" type="text/css" href="css/base.css" />
+<link rel="stylesheet" type="text/css" href="css/rst.css" />
 <link rel="stylesheet" href="style.css" type="text/css" />
 <style type="text/css">
 /* Hides from IE-mac \*/
@@ -20,15 +20,11 @@
     <div id="container">
     <div id="headerNav">
     <ul>
-    <li class="first"><a href="/">Home</a></li>
-    <li><a href="../../products.html">Products</a></li>
-    <li><a href="../../contact.html">Contact</a></li>
+    <li class="first"><a href="index.html">Home</a></li>
+    <li><a href="http://www.rasterbar.com/products.html">Products</a></li>
+    <li><a href="http://www.rasterbar.com/contact.html">Contact</a></li>
     </ul>
     </div>
-    <div id="header">
-    <h1><span>Rasterbar Software</span></h1>
-    <h2><span>Software developement and consulting</span></h2>
-    </div>
     <div id="main">
 <h1 class="title">Bittorrent udp-tracker protocol extension</h1>
 <table class="docinfo" frame="void" rules="none">
@@ -518,12 +514,6 @@
     <span>Copyright &copy; 2005 Rasterbar Software.</span>
     </div>
     </div>
-    <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
-    </script>
-    <script type="text/javascript">
-    _uacct = "UA-1599045-1";
-    urchinTracker();
-    </script>
 </div>
 </body>
 </html>
--- /dev/null
+++ b/docs/css/base.css
@@ -0,0 +1,136 @@
+/* Page template */
+
+html>body { font-size: 13px; }
+body { text-align: center; }
+
+#container {
+    text-align: left;
+    width: 700px;
+    margin: 0 auto;
+    position: relative;
+}
+
+#headerNav {
+}
+
+#headerNav ul {
+    margin: 2px;
+    list-style: none;
+    font-family: Tahoma;
+    text-align: right;
+    text-transform: uppercase;
+    line-height: 1em;
+}
+
+#headerNav ul li {
+    display: inline;
+    border-left: solid 1px #ccc;
+    padding-left: 10px;
+    padding-right: 10px;
+    margin: 0;
+    font-size: 80%;
+}
+
+#headerNav ul li.first {
+    border: 0;
+}
+
+#headerNav ul li a {
+    border: none;
+    color: #666;
+}
+
+#headerNav ul li a:hover {
+    background: #eee;
+}
+
+#header {
+    height: 116px;
+    width: 695px;
+    background: url(../img/orange.png) #FDA72A no-repeat top left;
+}
+
+#header h1 {
+    margin: 0;
+    padding: 0;
+    float: right;
+    width: 536px;
+    height: 116px;
+    background: url(../img/logo.png);
+}
+
+#header h1 span, #header h2 { display: none; }
+
+#footer {
+    clear: both;
+    width: 695px;
+    height: 49px;
+    background: #D3D3D3 url(../img/footer.png) no-repeat left top;
+    text-align: center;
+    margin-bottom: 1em;
+}
+
+#footer span {
+    line-height: 49px;
+    font-size: 88%;
+    text-align: center;
+    color: #777;
+    display: block;
+}
+
+#main {
+    font-family: Verdana;
+    line-height: 1.25em;
+    text-align: left;
+    margin-top: 10px;
+}
+
+/* Base elements */
+
+* {margin: 0; padding: 0;}
+body { font: 0.8125em Verdana, sans-serif;}
+
+h1, h2, h3 {
+    font: 1.5em Georgia "Times New Roman", serif;
+    letter-spacing: 1px;
+    padding-bottom: 0.5em;
+}
+
+h1 { font-size: 180%; }
+h2 { font-size: 130%; }
+h3 { font-size: 100%; }
+
+p {
+    font-size: 92%;
+    line-height: 1.7em;
+}
+
+a {
+    text-decoration: none;
+    color: #8D370A;
+    border-bottom: dotted 1px #8D370A;
+}
+
+a:hover {
+    border-bottom: solid 1px #8D370A;
+    background: #eee;
+}
+
+#librarySidebar {
+    float: left;
+    width: 150px;
+}
+
+#libraryBody {
+    border-left: solid 1px #eee;
+    padding-left: 10px;
+    margin-left: 158px;
+    margin-right: 10px;
+}
+
+ul, ol { line-height: 1.8em; }
+ul { list-style: square; }
+li { margin-left: 2.8em; font-size: 92%; }
+
+p, ul, ol, img {margin-bottom: 1em;}
+
--- /dev/null
+++ b/docs/css/rst.css
@@ -0,0 +1,245 @@
+.document {
+    margin-left: 10px;
+    margin-right: 10px;
+}
+
+.document a {
+    border: none;
+    color: black;
+}
+
+.document a:hover {
+    background: none;
+}
+
+.document a.reference {
+    color: #8D370A;
+    border-bottom: dotted 1px #8D370A;
+}
+
+.document a.reference:hover {
+    border-bottom: solid 1px #8D370A;
+    background: #eee;
+}
+
+div.section {
+    margin-bottom: 3em;
+}
+
+div.section div.section div.section {
+    margin-bottom: 2em;
+}
+
+h3 { text-transform: uppercase; }
+
+div.section p, div.section ul, div.section dl {
+}
+
+table.docinfo {
+    text-align: left;
+    float: right;
+    width: 200px;
+    margin-right: 0px;
+    margin-left: 20px;
+    margin-bottom: 20px;
+}
+
+table.docinfo th {
+    border-top: none;
+    font-size: 72%;
+    padding-left: 10px;
+}
+
+table.docinfo td {
+    padding-left: 10px;
+    font-size: 88%;
+}
+
+table.docinfo tr.field td, table.docinfo tr.field th {display: none;}
+
+h1.title { display: none; }
+
+dt {
+    font-size: 100%;
+    letter-spacing: 2px;
+    line-height: 1em;
+    color: #315586;
+    color: #000;
+    font-family: Tahoma;
+    font-weight: bold;
+}
+
+dd {
+    line-height: 1.5em;
+    margin-left: 1em;
+    margin-bottom: 1em;
+    font-size: 92%;
+}
+
+tt {
+    font: 1em "Courier New", "Courier";
+    color: #315566;
+}
+
+pre {
+    font-family: "Courier", monospace;
+    margin-right: 10px;
+    background: #C1E5F6;
+    border-left: solid 2px #6185A6;
+    border-right: solid 2px #6185A6;
+    padding: 5px 10px 5px 10px;
+
+    background: #f6f6f6;
+    border: solid 1px #ddd;
+    margin: 1em 0;
+}
+
+div.warning, div.note, div.important {
+    width: 80%;
+    margin: 1.5em auto;
+    background: #C1E5F6;
+    background: #F1FFF5;
+    border: solid 1px #D1DFD5;
+    padding: 5px 10px 5px 10px;
+}
+
+p.admonition-title {
+    font-family: Georgia, "Lucida Grande";
+    font-size: 128%;
+    letter-spacing: 2px;
+    text-transform: uppercase;
+    margin: 0 0 0.5em 0;
+    border-bottom: solid 1px #D1DFD5
+}
+
+div.sidebar {
+    background: #f8f8e8;
+    float: right;
+    width: 20em;
+    margin-right: 1em;
+    border: solid 1px #e5e5d5;
+    padding: 1.3em;
+}
+
+div.sidebar p.sidebar-title {
+    font: 1.3em Georgia;
+    border-bottom: solid 1px #e5e5d5;
+    padding-bottom: 0.5em;
+    margin: 0 0 0.5em 0;
+}
+
+h1 { font-size: 230%; }
+h2 { font-size: 180%; }
+h3 { font-size: 130%; }
+
+table { margin-bottom: 1em; border-collapse: collapse; }
+table, th, td { border: none; }
+
+th, td { padding: 0.3em; }
+
+th {
+    text-align: left;
+    background: #f0f0e0;
+    border-right: solid 1px #f0f0e0;
+    border-top: solid 1px #e8e8d8;
+    border-bottom: solid 1px #e8e8d8;
+}
+
+td {
+    background: #f8f8e8;
+    border-right: solid 1px #f8f8e8;
+    border-bottom: solid 1px #e8e8d8;
+}
+
+td td {
+    background: #e8e8d8;
+    border-right: solid 1px #e8e8d8;
+    border-bottom: solid 1px #d8d8c8;
+}
+
+div.topic {
+    border-left: solid 1px #eee;
+    padding-left: 1em;
+    margin: 0 0 1.5em;
+}
+
+p.topic-title {
+    font: 1.3em Georgia, "Times New Roman", serif;
+}
+
+/* TOC */
+
+div.contents {
+    border: none;
+}
+
+#table-of-contents {
+    margin-left: 20px;
+    padding: 0 0 1em;
+    width: 200px;
+    float: right;
+    clear: right;
+    background: url(../img/blue_bottom.png) no-repeat bottom left;
+    border-right: solid 1px #A1C5D6;
+}
+
+#table-of-contents p {
+    font-family: Georgia, "Times New Roman", serif;
+    background: #A1C5D6 url(../img/blue_top.png) no-repeat top left;
+    color: #AD370A;
+    padding: 0.5em;
+    margin: 0;
+}
+
+#table-of-contents li {
+    margin: 0 0.5em 0 0.5em;
+}
+
+#table-of-contents ul {
+    margin: 0;
+    padding: 0 0 0 0.8em;
+    list-style: none;
+    text-align: left;
+    line-height: 1.5em;
+}
+
+#table-of-contents ul ul {
+    background: url(../img/dotline.gif) repeat-y;
+}
+
+#table-of-contents a.reference {
+    border: none;
+    font: 0.88em Tahoma;
+    font-weight: bold;
+    color: #000050;
+    margin-right: 1em;
+    background: url(../img/minus.gif) no-repeat left 50%;
+    padding-left: 15px;
+}
+
+#table-of-contents li li a.reference {
+    font-weight: normal;
+    background: none;
+    padding: 0;
+}
+
+#table-of-contents a.reference:hover {text-decoration: underline;}
+
+dd p {
+    font-size: 100%;
+}
+
+dd pre {
+    font-size: 108.7%;
+}
+
+li p, li li { font-size: 100%; }
+
+/* IE Hacks */
+
+/* Hides from IE-mac \*/
+* html li pre { height: 1%; }
+* html .topic pre { height: 1%; }
+* html #table-of-contents ul ul { height: 1%; }
+/* End hide from IE-mac */
+
--- a/docs/index.rst
+++ b/docs/index.rst
@@ -71,7 +71,7 @@
 .. _`ruby bindings`: http://libtorrent-ruby.rubyforge.org/
 .. _`python bindings`: python_binding.html
 
-.. _`Introduction, slides`: bittorrent.pdf
+.. _`Introduction, slides`: http://www.rasterbar.com/products/libtorrent/bittorrent.pdf
 
 libtorrent is a C++ library that aims to be a good alternative to all the
 other bittorrent implementations around. It is a
@@ -90,21 +90,11 @@
 Donate
 ======
 
-Support the development of libtorrent
+Support the development of libtorrent.
 
-.. raw:: html
-	
-	<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
-		<input type="hidden" name="cmd" value="_xclick">
-		<input type="hidden" name="business" value="arvid@cs.umu.se">
-		<input type="hidden" name="item_name" value="libtorrent">
-		<input type="hidden" name="return" value="http://libtorrent.sf.net">
-		<input type="hidden" name="currency_code" value="USD">
-		<input type="hidden" name="tax" value="0">
-		<input type="image" src="https://www.paypal.com/images/x-click-but04.gif"
-			border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!">
-	</form>
+(via paypal__ on Rasterbar's homepage)
 
+__ http://www.rasterbar.com/products/libtorrent/index.html
 
 
 Feedback
@@ -126,11 +116,8 @@
 
 Thanks to Reimond Retz for bugfixes, suggestions and testing
 
-Project is hosted by sourceforge.
-
-|sf_logo|__
+Project is hosted by sourceforge__.
 
-.. |sf_logo| image:: http://sourceforge.net/sflogo.php?group_id=7994
 __ http://sourceforge.net
 
 .. raw:: html
